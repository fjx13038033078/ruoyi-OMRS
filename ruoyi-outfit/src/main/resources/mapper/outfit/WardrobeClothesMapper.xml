<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.outfit.mapper.WardrobeClothesMapper">
    
    <resultMap type="WardrobeClothes" id="WardrobeClothesResult">
        <id     property="id"            column="id"              />
        <result property="userId"        column="user_id"         />
        <result property="name"          column="name"            />
        <result property="category"      column="category"        />
        <result property="subCategory"   column="sub_category"    />
        <result property="season"        column="season"          />
        <result property="color"         column="color"           />
        <result property="colorHex"      column="color_hex"       />
        <result property="material"      column="material"        />
        <result property="brand"         column="brand"           />
        <result property="price"         column="price"           />
        <result property="purchaseDate"  column="purchase_date"   />
        <result property="size"          column="size"            />
        <result property="style"         column="style"           />
        <result property="occasion"      column="occasion"        />
        <result property="washMethod"    column="wash_method"     />
        <result property="imageUrl"      column="image_url"       />
        <result property="description"   column="description"     />
        <result property="wearCount"     column="wear_count"      />
        <result property="lastWearDate"  column="last_wear_date"  />
        <result property="isFavorite"    column="is_favorite"     />
        <result property="status"        column="status"          />
        <result property="delFlag"       column="del_flag"        />
        <result property="createBy"      column="create_by"       />
        <result property="createTime"    column="create_time"     />
        <result property="updateBy"      column="update_by"       />
        <result property="updateTime"    column="update_time"     />
        <result property="remark"        column="remark"          />
    </resultMap>

    <sql id="selectWardrobeClothesVo">
        select id, user_id, name, category, sub_category, season, color, color_hex, material, brand, price, purchase_date, size, style, occasion, wash_method, image_url, description, wear_count, last_wear_date, is_favorite, status, del_flag, create_by, create_time, update_by, update_time, remark
        from wardrobe_clothes
    </sql>

    <select id="selectWardrobeClothesList" parameterType="WardrobeClothes" resultMap="WardrobeClothesResult">
        <include refid="selectWardrobeClothesVo"/>
        <where>
            del_flag = '0'
            <if test="userId != null">
                and user_id = #{userId}
            </if>
            <if test="name != null and name != ''">
                and name like concat('%', #{name}, '%')
            </if>
            <if test="category != null and category != ''">
                and category = #{category}
            </if>
            <if test="subCategory != null and subCategory != ''">
                and sub_category = #{subCategory}
            </if>
            <if test="season != null and season != ''">
                and season = #{season}
            </if>
            <if test="color != null and color != ''">
                and color = #{color}
            </if>
            <if test="material != null and material != ''">
                and material = #{material}
            </if>
            <if test="brand != null and brand != ''">
                and brand like concat('%', #{brand}, '%')
            </if>
            <if test="style != null and style != ''">
                and style = #{style}
            </if>
            <if test="isFavorite != null and isFavorite != ''">
                and is_favorite = #{isFavorite}
            </if>
            <if test="status != null and status != ''">
                and status = #{status}
            </if>
        </where>
        order by create_time desc
    </select>
    
    <select id="selectWardrobeClothesById" parameterType="Long" resultMap="WardrobeClothesResult">
        <include refid="selectWardrobeClothesVo"/>
        where id = #{id} and del_flag = '0'
    </select>
        
    <insert id="insertWardrobeClothes" parameterType="WardrobeClothes" useGeneratedKeys="true" keyProperty="id">
        insert into wardrobe_clothes
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">user_id,</if>
            <if test="name != null and name != ''">name,</if>
            <if test="category != null and category != ''">category,</if>
            <if test="subCategory != null">sub_category,</if>
            <if test="season != null">season,</if>
            <if test="color != null">color,</if>
            <if test="colorHex != null">color_hex,</if>
            <if test="material != null">material,</if>
            <if test="brand != null">brand,</if>
            <if test="price != null">price,</if>
            <if test="purchaseDate != null">purchase_date,</if>
            <if test="size != null">size,</if>
            <if test="style != null">style,</if>
            <if test="occasion != null">occasion,</if>
            <if test="washMethod != null">wash_method,</if>
            <if test="imageUrl != null">image_url,</if>
            <if test="description != null">description,</if>
            <if test="wearCount != null">wear_count,</if>
            <if test="lastWearDate != null">last_wear_date,</if>
            <if test="isFavorite != null">is_favorite,</if>
            <if test="status != null">status,</if>
            <if test="delFlag != null">del_flag,</if>
            <if test="createBy != null">create_by,</if>
            <if test="remark != null">remark,</if>
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">#{userId},</if>
            <if test="name != null and name != ''">#{name},</if>
            <if test="category != null and category != ''">#{category},</if>
            <if test="subCategory != null">#{subCategory},</if>
            <if test="season != null">#{season},</if>
            <if test="color != null">#{color},</if>
            <if test="colorHex != null">#{colorHex},</if>
            <if test="material != null">#{material},</if>
            <if test="brand != null">#{brand},</if>
            <if test="price != null">#{price},</if>
            <if test="purchaseDate != null">#{purchaseDate},</if>
            <if test="size != null">#{size},</if>
            <if test="style != null">#{style},</if>
            <if test="occasion != null">#{occasion},</if>
            <if test="washMethod != null">#{washMethod},</if>
            <if test="imageUrl != null">#{imageUrl},</if>
            <if test="description != null">#{description},</if>
            <if test="wearCount != null">#{wearCount},</if>
            <if test="lastWearDate != null">#{lastWearDate},</if>
            <if test="isFavorite != null">#{isFavorite},</if>
            <if test="status != null">#{status},</if>
            <if test="delFlag != null">#{delFlag},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="remark != null">#{remark},</if>
            sysdate()
        </trim>
    </insert>

    <update id="updateWardrobeClothes" parameterType="WardrobeClothes">
        update wardrobe_clothes
        <trim prefix="SET" suffixOverrides=",">
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="category != null and category != ''">category = #{category},</if>
            <if test="subCategory != null">sub_category = #{subCategory},</if>
            <if test="season != null">season = #{season},</if>
            <if test="color != null">color = #{color},</if>
            <if test="colorHex != null">color_hex = #{colorHex},</if>
            <if test="material != null">material = #{material},</if>
            <if test="brand != null">brand = #{brand},</if>
            <if test="price != null">price = #{price},</if>
            <if test="purchaseDate != null">purchase_date = #{purchaseDate},</if>
            <if test="size != null">size = #{size},</if>
            <if test="style != null">style = #{style},</if>
            <if test="occasion != null">occasion = #{occasion},</if>
            <if test="washMethod != null">wash_method = #{washMethod},</if>
            <if test="imageUrl != null">image_url = #{imageUrl},</if>
            <if test="description != null">description = #{description},</if>
            <if test="wearCount != null">wear_count = #{wearCount},</if>
            <if test="lastWearDate != null">last_wear_date = #{lastWearDate},</if>
            <if test="isFavorite != null">is_favorite = #{isFavorite},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="remark != null">remark = #{remark},</if>
            update_time = sysdate()
        </trim>
        where id = #{id}
    </update>

    <update id="deleteWardrobeClothesById" parameterType="Long">
        update wardrobe_clothes set del_flag = '2' where id = #{id}
    </update>

    <update id="deleteWardrobeClothesByIds" parameterType="String">
        update wardrobe_clothes set del_flag = '2' where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <update id="updateWearRecord" parameterType="Long">
        update wardrobe_clothes 
        set wear_count = wear_count + 1, last_wear_date = curdate(), update_time = sysdate()
        where id = #{id}
    </update>

    <update id="updateFavorite" parameterType="WardrobeClothes">
        update wardrobe_clothes 
        set is_favorite = #{isFavorite}, update_time = sysdate()
        where id = #{id}
    </update>

    <select id="countByUserId" parameterType="Long" resultType="int">
        select count(*) from wardrobe_clothes where user_id = #{userId} and del_flag = '0'
    </select>

    <select id="countByCategory" parameterType="Long" resultType="java.util.Map">
        select category as name, count(*) as value 
        from wardrobe_clothes 
        where user_id = #{userId} and del_flag = '0'
        group by category
    </select>

    <select id="countBySeason" parameterType="Long" resultType="java.util.Map">
        select season as name, count(*) as value 
        from wardrobe_clothes 
        where user_id = #{userId} and del_flag = '0'
        group by season
    </select>

    <select id="countByColor" parameterType="Long" resultType="java.util.Map">
        select color as name, count(*) as value 
        from wardrobe_clothes 
        where user_id = #{userId} and del_flag = '0'
        group by color
    </select>
</mapper>

